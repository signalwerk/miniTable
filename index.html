<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>miniTable - Zdog 3D Model</title>
    <script src="https://unpkg.com/zdog@1/dist/zdog.dist.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, sans-serif;
        display: flex;
        height: 100vh;
        background-color: #f5f5f5;
      }
      
      #controls {
        width: 300px;
        padding: 20px;
        background-color: #f0f0f0;
        border-right: 1px solid #ddd;
        overflow-y: auto;
      }
      
      #canvas-container {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #ffeb3b; /* Yellow background */
      }
      
      canvas {
        display: block;
        cursor: move;
      }
      
      .control-group {
        margin-bottom: 15px;
      }
      
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      
      .input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      input[type="range"] {
        flex: 1;
      }
      
      input[type="number"] {
        width: 60px;
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      
      .unit {
        font-size: 12px;
        color: #666;
      }
      
      h1 {
        margin-top: 0;
        font-size: 24px;
      }
      
      button {
        padding: 8px 12px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
      }
      
      button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <h1>miniTable</h1>
      
      <div class="control-group">
        <label>Table Top Length:</label>
        <div class="input-wrapper">
          <input type="range" id="topLength" min="200" max="500" value="300">
          <input type="number" id="topLengthNum" min="200" max="500" value="300">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Table Top Width:</label>
        <div class="input-wrapper">
          <input type="range" id="topWidth" min="100" max="300" value="150">
          <input type="number" id="topWidthNum" min="100" max="300" value="150">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Table Top Thickness:</label>
        <div class="input-wrapper">
          <input type="range" id="topHeight" min="5" max="30" value="15">
          <input type="number" id="topHeightNum" min="5" max="30" value="15">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Leg Height:</label>
        <div class="input-wrapper">
          <input type="range" id="legHeight" min="50" max="200" value="120">
          <input type="number" id="legHeightNum" min="50" max="200" value="120">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Leg Width:</label>
        <div class="input-wrapper">
          <input type="range" id="legWidth" min="5" max="20" value="8">
          <input type="number" id="legWidthNum" min="5" max="20" value="8">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Support Bar Size:</label>
        <div class="input-wrapper">
          <input type="range" id="barSize" min="5" max="20" value="10">
          <input type="number" id="barSizeNum" min="5" max="20" value="10">
          <span class="unit">mm</span>
        </div>
      </div>
      
      <div class="control-group">
        <label>Stroke Size:</label>
        <div class="input-wrapper">
          <input type="range" id="strokeSize" min="1" max="5" value="2" step="0.5">
          <input type="number" id="strokeSizeNum" min="1" max="5" value="2" step="0.5">
          <span class="unit">px</span>
        </div>
      </div>
      
      <button id="resetCamera">Reset Camera</button>
    </div>
    
    <div id="canvas-container">
      <canvas id="zdog-canvas" width="800" height="600"></canvas>
    </div>

    <script>
      // Initialize Zdog illustration
      let isSpinning = true;
      
      const illo = new Zdog.Illustration({
        element: '#zdog-canvas',
        dragRotate: true,
        zoom: 1.5,
        rotate: { x: -0.3, y: 0.6 },
        onDragStart: function() {
          isSpinning = false;
        }
      });
      
      // Global styling constants
      const styles = {
        fill: 'white',
        stroke: 'black',
        outlineOffset: 0.2, // Absolute size difference for outline in px
        strokeWidth: 2,
        legInset: 0.1 // Inset legs by 10% from edges
      };
      
      // Parameters
      let params = {
        topLength: 300,
        topWidth: 150,
        topHeight: 15,
        legHeight: 120,
        legWidth: 8,
        barSize: 10,
        strokeSize: 2
      };
      
      // Store all table parts in an array
      let tableParts = [];
      
      // Create a box with fill and stroke
      function createBox(options) {
        // Create the filled inner box
        const fillBox = new Zdog.Box({
          addTo: illo,
          width: options.width,
          height: options.height,
          depth: options.depth,
          color: styles.fill,
          stroke: false,
          translate: options.translate,
        });
        tableParts.push(fillBox);
        
        // Create the stroked outer box (with absolute size difference)
        const strokeBox = new Zdog.Box({
          addTo: illo,
          width: options.width + styles.outlineOffset,
          height: options.height + styles.outlineOffset,
          depth: options.depth + styles.outlineOffset,
          color: styles.stroke,
          fill: false,
          stroke: styles.strokeWidth,
          translate: options.translate,
        });
        tableParts.push(strokeBox);
      }
      
      // Create table parts
      function createTable() {
        // Remove all existing parts
        tableParts.forEach(part => part.remove());
        tableParts = [];
        
        // Update global stroke width from parameters
        styles.strokeWidth = params.strokeSize;
        
        // Table top
        createBox({
          width: params.topLength,
          height: params.topHeight,
          depth: params.topWidth,
          translate: { y: -params.topHeight/2 },
        });
        
        // Calculate leg inset distances
        const lengthInset = params.topLength * styles.legInset;
        const widthInset = params.topWidth * styles.legInset;
        
        // Legs
        const legPositions = [
          { x: params.topLength/2 - lengthInset - params.legWidth/2, z: params.topWidth/2 - widthInset - params.legWidth/2 },
          { x: -params.topLength/2 + lengthInset + params.legWidth/2, z: params.topWidth/2 - widthInset - params.legWidth/2 },
          { x: -params.topLength/2 + lengthInset + params.legWidth/2, z: -params.topWidth/2 + widthInset + params.legWidth/2 },
          { x: params.topLength/2 - lengthInset - params.legWidth/2, z: -params.topWidth/2 + widthInset + params.legWidth/2 }
        ];
        
        legPositions.forEach(pos => {
          createBox({
            width: params.legWidth,
            height: params.legHeight,
            depth: params.legWidth,
            translate: { 
              x: pos.x, 
              y: params.legHeight/2 + params.topHeight/2, 
              z: pos.z 
            },
          });
        });
        
        // Support bars (front and back)
        createBox({
          width: params.topLength - 2*(lengthInset + params.legWidth),
          height: params.barSize,
          depth: params.barSize,
          translate: { 
            y: params.legHeight*0.3 + params.topHeight/2,
            z: params.topWidth/2 - widthInset - params.legWidth/2 - params.barSize/2
          },
        });
        
        createBox({
          width: params.topLength - 2*(lengthInset + params.legWidth),
          height: params.barSize,
          depth: params.barSize,
          translate: { 
            y: params.legHeight*0.3 + params.topHeight/2,
            z: -params.topWidth/2 + widthInset + params.legWidth/2 + params.barSize/2
          },
        });
        
        // Support bars (left and right)
        createBox({
          width: params.barSize,
          height: params.barSize,
          depth: params.topWidth - 2*(widthInset + params.legWidth),
          translate: { 
            x: params.topLength/2 - lengthInset - params.legWidth/2 - params.barSize/2,
            y: params.legHeight*0.3 + params.topHeight/2
          },
        });
        
        createBox({
          width: params.barSize,
          height: params.barSize,
          depth: params.topWidth - 2*(widthInset + params.legWidth),
          translate: { 
            x: -params.topLength/2 + lengthInset + params.legWidth/2 + params.barSize/2,
            y: params.legHeight*0.3 + params.topHeight/2
          },
        });
      }
      
      // Initial table creation
      createTable();
      
      // Animation loop
      function animate() {
        // Add slight rotation when not being dragged
        if (isSpinning) {
          illo.rotate.y += 0.003;
        }
        
        illo.updateRenderGraph();
        requestAnimationFrame(animate);
      }
      animate();
      
      // UI controls
      const sliders = {
        topLength: document.getElementById('topLength'),
        topWidth: document.getElementById('topWidth'),
        topHeight: document.getElementById('topHeight'),
        legHeight: document.getElementById('legHeight'),
        legWidth: document.getElementById('legWidth'),
        barSize: document.getElementById('barSize'),
        strokeSize: document.getElementById('strokeSize')
      };
      
      const numberInputs = {
        topLength: document.getElementById('topLengthNum'),
        topWidth: document.getElementById('topWidthNum'),
        topHeight: document.getElementById('topHeightNum'),
        legHeight: document.getElementById('legHeightNum'),
        legWidth: document.getElementById('legWidthNum'),
        barSize: document.getElementById('barSizeNum'),
        strokeSize: document.getElementById('strokeSizeNum')
      };
      
      // Update functions for sliders
      Object.keys(sliders).forEach(key => {
        // Update number input when slider changes
        sliders[key].addEventListener('input', () => {
          const value = parseFloat(sliders[key].value);
          params[key] = value;
          numberInputs[key].value = value;
          createTable();
        });
        
        // Update slider when number input changes
        numberInputs[key].addEventListener('input', () => {
          const value = parseFloat(numberInputs[key].value);
          // Clamp value to min/max
          const min = parseFloat(sliders[key].min);
          const max = parseFloat(sliders[key].max);
          const clampedValue = Math.max(min, Math.min(max, value));
          
          params[key] = clampedValue;
          numberInputs[key].value = clampedValue;
          sliders[key].value = clampedValue;
          createTable();
        });
      });
      
      // Reset camera
      document.getElementById('resetCamera').addEventListener('click', () => {
        illo.rotate.x = -0.3;
        illo.rotate.y = 0.6;
        illo.rotate.z = 0;
        isSpinning = true;
      });
    </script>
  </body>
</html>
